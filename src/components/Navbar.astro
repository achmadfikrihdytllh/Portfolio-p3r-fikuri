---
// src/components/Navbar.astro
const links = [
  { name: "HOME", href: "#top" },
  { name: "SKILLS", href: "#skills" },
  { name: "PROJECTS", href: "#projects" },
  { name: "CONTACT", href: "#contact" },
];
---

<nav id="navbar-system" class="fixed top-2 md:top-6 left-2 md:left-6 z-[9000] flex flex-col items-start gap-2 opacity-0 -translate-x-10 transition-all duration-1000 ease-out">
    
    <button id="menu-toggle-btn" class="group relative focus:outline-none p-1 transition-transform duration-300 hover:scale-105 active:scale-95">
        <img 
            src="/aigis-icon.png" 
            alt="System Menu" 
            class="w-20 h-20 md:w-40 md:h-40 object-contain group-hover:rotate-12 transition-all duration-300 drop-shadow-[0_0_15px_rgba(0,240,255,0.6)]"
        />
    </button>

    <div id="menu-dropdown" class="flex flex-col items-start gap-2 pl-2 md:pl-4 overflow-hidden max-h-0 opacity-0 transition-all duration-500 ease-out origin-top-left">
        
        {links.map((link, index) => (
            <a href={link.href} class="menu-item group relative block opacity-0 -translate-x-5 transition-all duration-300" style={`transition-delay: ${index * 100}ms`}>
                <div class="bg-black/90 border-l-2 border-gray-600 px-6 py-2 -skew-x-12 hover:bg-cyan-600 hover:border-white hover:pl-8 transition-all duration-200 min-w-[150px] shadow-[0_0_10px_rgba(0,0,0,0.5)]">
                    <span class="block skew-x-12 text-sm font-bold text-gray-300 group-hover:text-white tracking-widest">
                        {link.name}
                    </span>
                </div>
            </a>
        ))}

    </div>
</nav>

<script>
    const menuBtn = document.getElementById('menu-toggle-btn');
    const dropdown = document.getElementById('menu-dropdown');
    const menuItems = document.querySelectorAll('.menu-item');
    const navbarContainer = document.getElementById('navbar-system');
    
    let isOpen = false;
    let isAnimating = false; 

    function toggleMenu() {
        if (isAnimating) return; 
        
        isOpen = !isOpen;
        isAnimating = true;

        if (isOpen) {
            dropdown?.classList.remove('max-h-0', 'opacity-0');
            dropdown?.classList.add('max-h-[500px]', 'opacity-100');
            
            menuItems.forEach((item, idx) => {
                setTimeout(() => {
                    item.classList.remove('opacity-0', '-translate-x-5');
                }, idx * 100); 
            });

            setTimeout(() => { isAnimating = false; }, menuItems.length * 100);

        } else {
            menuItems.forEach((item, idx) => {
                const reverseDelay = (menuItems.length - 1 - idx) * 100;
                setTimeout(() => {
                    item.classList.add('opacity-0', '-translate-x-5');
                }, reverseDelay);
            });

            setTimeout(() => {
                dropdown?.classList.remove('max-h-[500px]', 'opacity-100');
                dropdown?.classList.add('max-h-0', 'opacity-0');
                isAnimating = false; 
            }, menuItems.length * 100);
        }
    }

    menuBtn?.addEventListener('click', toggleMenu);

    menuItems.forEach(link => {
        link.addEventListener('click', () => {
            if(isOpen) toggleMenu();
        });
    });

    document.addEventListener('personaSummoned', () => {
        if (navbarContainer) {
            navbarContainer.classList.remove('opacity-0', '-translate-x-10');
            navbarContainer.classList.add('translate-x-0');
        }
    });
</script>