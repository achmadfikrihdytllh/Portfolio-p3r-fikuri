---
// src/components/ProjectModal.astro
---

<div 
    id="project-modal" 
    class="fixed inset-0 z-[10000] hidden transition-all duration-300 opacity-0"
>
    <div class="absolute inset-0 bg-[#000a12]/95 backdrop-blur-xl"></div>
    <div class="absolute inset-0 pointer-events-none opacity-20 bg-[repeating-linear-gradient(45deg,#00f0ff,#00f0ff_1px,transparent_1px,transparent_10px)]"></div>
    
    <div class="absolute top-1/4 -left-20 text-[15rem] font-black italic text-white opacity-5 select-none pointer-events-none -rotate-12 uppercase leading-none">
        DATA SCAN
    </div>

    <div class="relative w-full h-full overflow-y-auto custom-modal-scroll">
        <div class="min-h-screen flex flex-col p-4 md:p-20">
            
            <button 
                id="close-modal" 
                class="fixed top-6 right-6 md:top-10 md:right-10 z-[10002] group focus:outline-none"
            >
                <div class="bg-red-500 text-white font-black px-8 py-3 -skew-x-12 shadow-[4px_4px_0_white] group-hover:bg-cyan-400 group-hover:shadow-[4px_4px_0_red] transition-all duration-300 active:scale-95">
                    <span class="block skew-x-12 tracking-widest uppercase">BACK [ESC]</span>
                </div>
            </button>

            <div class="max-w-7xl mx-auto w-full pt-16 md:pt-0 relative z-10">
                <header class="mb-16 -skew-x-6 border-l-8 border-cyan-400 pl-6 md:pl-10">
                    <p id="modal-category" class="text-cyan-400 font-mono tracking-[0.3em] text-sm md:text-base mb-2 uppercase opacity-80 italic"></p>
                    <h2 id="modal-title" class="text-5xl md:text-8xl font-black italic text-white uppercase tracking-tighter leading-none drop-shadow-[4px_4px_0_rgba(0,0,0,0.5)]"></h2>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-16 items-start">
                    
                    <div class="lg:col-span-5 space-y-12">
                        <div class="relative group">
                            <div class="absolute -inset-2 bg-cyan-500/10 -skew-x-2 opacity-100"></div>
                            <div class="relative bg-black/40 border border-white/10 p-8 -skew-x-2 backdrop-blur-sm">
                                <h3 class="text-cyan-400 font-black mb-6 tracking-widest text-lg bg-cyan-900/30 px-4 py-1 inline-block uppercase italic">ANALYSIS REPORT</h3>
                                <p id="modal-desc" class="text-gray-200 text-lg leading-relaxed italic font-medium"></p>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-white font-black italic mb-8 tracking-widest text-lg border-b-2 border-white/20 pb-2 uppercase">CORE_SYSTEM_FEATURES</h3>
                            <div class="max-h-[300px] md:max-h-[400px] overflow-y-auto pr-4 custom-inner-scroll">
                                <ul id="modal-features" class="grid grid-cols-1 gap-4"></ul>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-7 space-y-6">
                        <div class="flex items-center justify-between border-b-2 border-cyan-400/50 pb-4">
                            <h3 class="text-cyan-400 font-black tracking-widest text-xl uppercase italic">Visual-Web</h3>
                            <span id="gallery-counter" class="text-xs font-mono text-cyan-400/50 italic uppercase tracking-tighter"></span>
                        </div>

                        <div 
                            id="modal-gallery" 
                            class="grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto pr-4 max-h-[500px] md:max-h-[70vh] custom-inner-scroll"
                        ></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="lightbox-overlay" class="fixed inset-0 z-[11000] hidden items-center justify-center bg-black/95 backdrop-blur-xl cursor-zoom-out opacity-0 transition-opacity duration-300">
    <div class="relative max-w-[90vw] max-h-[90vh] -skew-x-1 border-2 border-cyan-400 p-2 bg-black shadow-[0_0_50px_rgba(0,240,255,0.3)]">
        <img id="lightbox-img" src="" class="w-full h-full object-contain" alt="Lightbox Preview" />
        <div class="absolute -bottom-10 left-0 bg-cyan-400 text-black px-4 py-1 font-black italic text-sm -skew-x-12 uppercase">Full_Visual_Data_Preview</div>
    </div>
</div>

<script>
    // Logika script anda tetap sama karena ID modal-features dan modal-gallery tidak berubah
    const initModal = () => {
        const modal = document.getElementById('project-modal');
        const scrollContainer = modal?.querySelector('.custom-modal-scroll'); 
        const closeBtn = document.getElementById('close-modal');
        const openBtns = document.querySelectorAll('.open-detail-btn');
        const lightbox = document.getElementById('lightbox-overlay');
        const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;

        const openModal = (projectData: string) => {
            const project = JSON.parse(projectData);
            if (scrollContainer) scrollContainer.scrollTop = 0; 

            document.getElementById('modal-title')!.innerText = project.title;
            document.getElementById('modal-category')!.innerText = `// ${project.category}`;
            document.getElementById('modal-desc')!.innerText = project.fullDescription || project.description;

            const featureList = document.getElementById('modal-features');
            if (featureList && project.features) {
                featureList.innerHTML = project.features.map((f: string, i: number) => `
                    <li class="flex items-center gap-4 text-white font-bold bg-white/5 p-4 -skew-x-12 border-l-4 border-cyan-500 opacity-0" style="animation: featureSlide 0.3s forwards ${i * 0.1}s">
                        <span class="w-3 h-3 bg-cyan-400 rotate-45 flex-shrink-0 shadow-[2px_2px_0_white]"></span>
                        <span class="skew-x-12 tracking-tight uppercase">${f}</span>
                    </li>
                `).join('');
            }

            const galleryDiv = document.getElementById('modal-gallery');
            const counterEl = document.getElementById('gallery-counter');
            if (galleryDiv && project.gallery) {
                const limitedGallery = project.gallery.slice(0, 10);
                if (counterEl) counterEl.innerText = `SCANNING_COMPLETE: ${limitedGallery.length}_FILES_FOUND`;

                galleryDiv.innerHTML = limitedGallery.map((img: string) => `
                    <div class="relative group aspect-video cursor-zoom-in">
                        <div class="absolute -inset-1 bg-cyan-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-500 z-0"></div>
                        <div class="relative h-full overflow-hidden border-2 border-white/10 -skew-x-1 bg-black z-10 transition-transform duration-500 group-hover:-translate-y-1">
                            <img src="${img}" class="gallery-item w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700 opacity-80 group-hover:opacity-100" data-full="${img}" alt="Gallery Project" />
                        </div>
                    </div>
                `).join('');

                galleryDiv.querySelectorAll('.gallery-item').forEach(img => {
                    img.addEventListener('click', (e) => {
                        const fullSrc = (e.target as HTMLImageElement).getAttribute('data-full');
                        if (fullSrc && lightboxImg && lightbox) {
                            lightboxImg.src = fullSrc;
                            lightbox.classList.remove('hidden');
                            lightbox.classList.add('flex'); 
                            setTimeout(() => lightbox.classList.add('opacity-100'), 10);
                        }
                    });
                });
            }

            modal?.classList.remove('hidden');
            setTimeout(() => {
                modal?.classList.add('opacity-100');
                document.body.style.overflow = 'hidden';
            }, 10);
        };

        const closeModal = () => {
            modal?.classList.remove('opacity-100');
            setTimeout(() => {
                modal?.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 300);
        };

        const closeLightbox = () => {
            if (lightbox) {
                lightbox.classList.remove('opacity-100');
                setTimeout(() => {
                    lightbox.classList.add('hidden');
                    lightbox.classList.remove('flex');
                }, 300);
            }
        };

        openBtns.forEach(btn => btn.addEventListener('click', () => {
            const data = btn.getAttribute('data-project');
            if (data) openModal(data);
        }));

        closeBtn?.addEventListener('click', closeModal);
        lightbox?.addEventListener('click', closeLightbox);
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (lightbox && !lightbox.classList.contains('hidden')) closeLightbox();
                else if (modal && !modal.classList.contains('hidden')) closeModal();
            }
        });
    };

    initModal();
    document.addEventListener('astro:after-swap', initModal);
</script>

<style>
    @keyframes featureSlide {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    /* Scrollbar Styling */
    .custom-modal-scroll::-webkit-scrollbar { width: 10px; }
    .custom-modal-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-modal-scroll::-webkit-scrollbar-thumb { background: #00f0ff; border-radius: 4px; border: 2px solid #000a12; }

    .custom-inner-scroll::-webkit-scrollbar { width: 4px; }
    .custom-inner-scroll::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
    .custom-inner-scroll::-webkit-scrollbar-thumb { background: #00f0ff; }
</style>